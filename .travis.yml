sudo: false
language: python
matrix:
  include:
    - python: "2.7"
    # Test on pypy without coverage, because it's unnecessary and very slow.
    - python: "pypy"
    env: PYPY_VERSION="5.3" NO_COVERAGE=1 PYTHON_BUILD_CACHE_PATH="$HOME/pyenv-cache"
cache:
  - pip
  - directories:
    - $HOME/pyenv-cache
before_install:
  - |
      if [[ -n "$PYPY_VERSION" ]]; then
        source .travis/setup-pypy.sh
        python --version 2>&1 | fgrep "PyPy $PYPY_VERSION"
      fi
install:
  - "pip install -r requirements.txt"
  - "pip install coveralls"
  - "pip install flake8"
script:
  - if [ -z "$NO_COVERAGE" ]; then COVERAGE_CMD="coverage run --source=telegram"; else COVERAGE_CMD=""; fi
  - flake8 telegram
  - VUMITEST_REDIS_DB=1 $COVERAGE_CMD `which trial` telegram

after_success:
  - if [ -z "$NO_COVERAGE" ]; then coveralls; fi
